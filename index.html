<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Primary Meta Tags -->
  <title>video Live</title>
  <meta name="title" content="video Live" />
  <meta name="description" content="" />
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="img/favicon.svg" />
  <!-- Custom style  -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <section class="videLive">
    <video class="bigVideo" autoplay muted loop
    src="8408ca9ab745a04fb640b8ba60c446a1_live1-session1_0.mp4"></video>
  <div class="spaceInner">
    <video class="smallVideo" id="smallVideo" autoplay muted loop ></video>
  </div>
    <div class="actions">
      <div class="icon video mute">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="24"
          height="24" x="0" y="0" viewBox="0 0 467.968 467.968" style="enable-background:new 0 0 512 512"
          xml:space="preserve">
          <g>
            <path
              d="M264.704 96.512H51.2c-28.16 0-51.2 23.04-51.2 51.2v172.544c0 28.16 23.04 51.2 51.2 51.2h213.504c28.16 0 51.2-23.04 51.2-51.2V147.712c0-28.672-23.04-51.2-51.2-51.2zM430.08 124.672c-3.072.512-6.144 2.048-8.704 3.584l-79.872 46.08V293.12l80.384 46.08c14.848 8.704 33.28 3.584 41.984-11.264 2.56-4.608 4.096-9.728 4.096-15.36V154.368c0-18.944-17.92-34.304-37.888-29.696z"
              fill="#FFFFFF" opacity="1" data-original="#000000"></path>
          </g>
        </svg>
      </div>
      <div class="icon mic mute ">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="24"
          height="24" x="0" y="0" viewBox="0 0 435.149 435.149" style="enable-background:new 0 0 512 512"
          xml:space="preserve" class="">
          <g>
            <path
              d="M356.992 224.922c0-8.483-6.877-15.36-15.36-15.36s-15.36 6.877-15.36 15.36c-.009 60.032-48.682 108.69-108.714 108.681-60.019-.009-108.672-48.662-108.681-108.681 0-8.483-6.877-15.36-15.36-15.36s-15.36 6.877-15.36 15.36c.081 71.019 53.479 130.653 124.058 138.547v40.96h-55.859c-8.483 0-15.36 6.877-15.36 15.36s6.877 15.36 15.36 15.36h142.438c8.483 0 15.36-6.877 15.36-15.36s-6.877-15.36-15.36-15.36h-55.859v-40.96c70.578-7.894 123.976-67.528 124.057-138.547z"
              fill="#FFFFFF" opacity="1" data-original="#000000" class=""></path>
            <path
              d="M217.574 0c-47.307 0-85.658 38.35-85.658 85.658v138.701c.056 47.284 38.374 85.601 85.658 85.658 47.284-.056 85.601-38.374 85.658-85.658V85.658C303.232 38.35 264.882 0 217.574 0z"
              fill="#FFFFFF" opacity="1" data-original="#000000" class=""></path>
          </g>
        </svg>
      </div>
      <div class="icon rotate" id="switchCamera">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="24"
          height="24" x="0" y="0" viewBox="0 0 32 32" style="enable-background:new 0 0 512 512" xml:space="preserve"
          class="">
          <g>
            <path
              d="M27 8h-2.764a.994.994 0 0 1-.894-.553l-.895-1.789A2.984 2.984 0 0 0 19.764 4h-7.528a2.984 2.984 0 0 0-2.683 1.658l-.9 1.789A.994.994 0 0 1 7.764 8H5a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3h22a3 3 0 0 0 3-3V11a3 3 0 0 0-3-3zM10.02 18.33a1 1 0 0 1-1-.94 6.993 6.993 0 0 1 10.358-6.521.988.988 0 0 1 .865-.526 1 1 0 0 1 1 1v1.415a1 1 0 0 1-1 1h-1.414a1 1 0 0 1-1-1 1.012 1.012 0 0 1 .073-.366A4.935 4.935 0 0 0 16 12a4.966 4.966 0 0 0-4.98 5.26 1 1 0 0 1-.94 1.06c-.02 0-.04.01-.06.01zm10.93 3.62a7 7 0 0 1-8.328 1.181.988.988 0 0 1-.865.526 1 1 0 0 1-1-1v-1.415a1 1 0 0 1 1-1h1.414a1 1 0 0 1 1 1 1.012 1.012 0 0 1-.073.366A4.935 4.935 0 0 0 16 22a4.966 4.966 0 0 0 4.98-5.26 1 1 0 0 1 .94-1.06.984.984 0 0 1 1.06.93 6.955 6.955 0 0 1-2.03 5.34z"
              data-name="Layer 2" fill="#FFFFFF" opacity="1" data-original="#000000" class=""></path>
          </g>
        </svg>
      </div>
      <div class="icon cancel">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" width="24"
          height="24" x="0" y="0" viewBox="0 0 24 24" style="enable-background:new 0 0 512 512" xml:space="preserve"
          class="">
          <g transform="matrix(1.1600000000000004,0,0,1.1600000000000004,-1.9200470352172818,-1.919947509765624)">
            <path
              d="M2.219 14.25a2.08 2.08 0 0 1 .166-2.133A11.722 11.722 0 0 1 12 7a11.722 11.722 0 0 1 9.615 5.117 2.08 2.08 0 0 1 .167 2.133l-1.083 2.177a1.027 1.027 0 0 1-1.382.463l-2.629-1.321a1.036 1.036 0 0 1-.569-.926L16 12s-.91-1.894-4-1.894S8 12 8 12l-.12 2.643a1.036 1.036 0 0 1-.568.926l-2.63 1.322a1.027 1.027 0 0 1-1.38-.464z"
              fill="#FFFFFF" opacity="1" data-original="#000000" class=""></path>
          </g>
        </svg>
      </div>
    </div>
  </section>
  <script>
        let currentStream;
    let videoDevices;
    let currentDeviceIndex = 0;
    function dragElement(element) {
      var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      var parentElement = document.querySelector(".spaceInner");

      // المسافة من الحواف
      var margin = 10;

      // إضافة خاصية الانتقال (animation) للحركة السلسة
      element.style.transition = "left 0.5s ease, top 0.5s ease";

      element.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;

        // إيقاف الحركة المؤقتة أثناء السحب
        element.style.transition = "";
      }

      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;

        var parentRect = parentElement.getBoundingClientRect();
        var elementRect = element.getBoundingClientRect();

        // حساب الموضع الجديد
        var newTop = element.offsetTop - pos2;
        var newLeft = element.offsetLeft - pos1;

        // تأكد من أن الفيديو لا يخرج عن الحواف العلوية أو السفلية
        if (newTop < margin) {
          newTop = margin;
        } else if (newTop + elementRect.height > parentRect.height - margin) {
          newTop = parentRect.height - elementRect.height - margin;
        }

        element.style.top = newTop + "px";
        element.style.left = newLeft + "px";

      }

      function closeDragElement() {
        // أوقف السحب
        document.onmouseup = null;
        document.onmousemove = null;

        // بعد الإفلات، أعد خاصية الانتقال (animation) للحركة السلسة
        element.style.transition = "left 0.5s ease, top 0.5s ease";

        // حرك الفيديو تلقائيًا إلى الحافة الأقرب (اليمين أو اليسار فقط)
        snapToClosestSide();
      }

      function snapToClosestSide() {
        var parentRect = parentElement.getBoundingClientRect();
        var elementRect = element.getBoundingClientRect();

        // حساب المسافات إلى الحافتين اليمين واليسار
        var distanceLeft = elementRect.left - parentRect.left;
        var distanceRight = parentRect.right - elementRect.right;

        // مقارنة المسافات وتوجيه الفيديو إلى الحافة الأقرب
        if (distanceLeft < distanceRight) {
          // الحافة اليسرى
          element.style.left = margin + "px";
        } else {
          // الحافة اليمنى
          element.style.left = (parentRect.width - elementRect.width - margin) + "px";
        }
      }
    }

    // استدعاء وظيفة السحب للفيديو الصغير
    dragElement(document.getElementById("smallVideo"));


 // دالة لتشغيل الكاميرا
 async function startCamera(deviceId = null) {
      try {
        const constraints = {
          video: {
            facingMode: deviceId ? { exact: deviceId } : "user"
          }
        };
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        const smallVideo = document.getElementById("smallVideo");
        smallVideo.srcObject = currentStream; // ربط دفق الكاميرا بعنصر الفيديو
        smallVideo.play(); // تشغيل الفيديو
      } catch (error) {
        const constraints = {
          video: {
            facingMode:  "user"
          }
        };
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        const smallVideo = document.getElementById("smallVideo");
        smallVideo.srcObject = currentStream; // ربط دفق الكاميرا بعنصر الفيديو
        smallVideo.play(); // تشغيل الفيديو
        console.error("Error accessing the camera:", error);
      }
    }

    // دالة لتحديث قائمة الأجهزة
    async function updateDevices() {
      videoDevices = (await navigator.mediaDevices.enumerateDevices()).filter(device => device.kind === 'videoinput');
    }

    // دالة لتبديل الكاميرا
    async function switchCamera() {
      try{
        currentDeviceIndex = (currentDeviceIndex + 1) % videoDevices.length;
      const nextDeviceId = videoDevices[currentDeviceIndex]?.deviceId;
      if (nextDeviceId) {
        // إنهاء دفق الكاميرا الحالي
        currentStream.getTracks().forEach(track => track.stop());
        await startCamera(nextDeviceId);
      }
      }catch{

      }
    
    }

    // استدعاء دالة بدء الكاميرا عند تحميل الصفحة
    window.onload = async () => {
      await updateDevices(); // تحديث الأجهزة عند تحميل الصفحة
      await startCamera(); // بدء الكاميرا
      document.getElementById("switchCamera").onclick = switchCamera; // ربط الزر بوظيفة تبديل الكاميرا
    };

  </script>

</body>

</html>